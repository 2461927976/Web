<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <link rel="shortcut icon" href="/images/bitbug_favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/loading.css">
    <link rel="stylesheet" type="text/css" href="/css/index.css">
	<title>俊贴吧</title>
</head>
<body>
  <!-- 等待窗口 -->
  <div class="loading">
    <div class="pic">
      <i></i>
      <i></i>
      <i></i>
      <i></i>
    </div>
  </div>

  <header>
      <nav class="navbar navbar-inverse">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <a class="navbar-brand" href="/">俊贴吧</a>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

            <ul class="nav navbar-nav">
              <li class="active"><a href="/">主页<span class="sr-only">(current)</span></a></li>
              <%
                if(login){
              %>
              <li><a href="#">我的帖子</a></li>
              <%
                }else{
              %>
              <li></li>
              <%
                }
              %>
            </ul>
            <%
              if(!login){
            %>
            <ul class="nav navbar-nav navbar-right login">
              <li><a href="/regist">注册</a><span>/</span><a href="javascript:void(0)" id="login">登录</a></li>
            </ul>
            <%
              }else{
            %>
            <ul class="nav navbar-nav navbar-right login">
              <li id="pcenter"><a href="/pcenter" title="">欢迎您！<%=username%></a></li>
            </ul>
            <%
              }
            %>
            <form class="navbar-form navbar-right">
              <div class="form-group">
                <input type="text" class="form-control" placeholder="请输入搜索内容">
              </div>
              <button type="submit" class="btn btn-default">搜索</button>
            </form>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>
  </header>
  

  <!-- 登录界面 -->
  <div class="mark1" id="mark1"></div>
  <div class="form1" id="form1">
    <div class="toubu">俊贴吧</div>
      <div class="form-group">
        <label for="exampleInputEmail1">用户名</label>
        <input type="text" class="form-control" id="username" aria-describedby="emailHelp" placeholder="请输入您的用户名">
      </div>
      <div class="form-group">
        <label for="exampleInputPassword1">密码</label>
        <input type="password" class="form-control" id="psd" placeholder="请输入密码">
      </div>
      <div class="confirm">
        <input type="text" name="confirm" id="confirm" placeholder="请输入验证码">
        <img src="/captcha" alt="验证码" id="confirmImg">
        <p class="tip-block">区分大小写</p>
        <p class="err-block">验证码错误</p>
      </div>
      <button type="button" class="btn btn-primary" id="login1">登录</button>
      <button type="button" class="btn btn-secondary" id="Fregist">注册</button>
  </div>

  <div class="container">
    <div class="col-md-4">
      <div class="list-group">
        <a href="#" class="list-group-item active">
          最新
        </a>
        <a href="#" class="list-group-item">Dapibus ac facilisis in</a>
        <a href="#" class="list-group-item">Morbi leo risus</a>
        <a href="#" class="list-group-item">Porta ac consectetur ac</a>
        <a href="#" class="list-group-item">Vestibulum at eros</a>
        <a href="#" class="list-group-item">Vestibulum at eros</a>
      </div>
    </div>
    <div class="col-md-4">
      <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
          <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
          <li data-target="#carousel-example-generic" data-slide-to="1"></li>
          <li data-target="#carousel-example-generic" data-slide-to="2"></li>
          <li data-target="#carousel-example-generic" data-slide-to="3"></li>
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox">
          <div class="item active">
            <img src="/images/01.jpg" alt="1">
            <div class="carousel-caption">
              人间仙境
            </div>
          </div>
          <div class="item">
            <img src="/images/02.jpg" alt="2">
            <div class="carousel-caption">
              世界杯
            </div>
          </div>
          <div class="item">
            <img src="/images/03.jpg" alt="2">
            <div class="carousel-caption">
              中美贸易战
            </div>
          </div>
          <div class="item">
            <img src="/images/04.jpg" alt="2">
            <div class="carousel-caption">
              区块链
            </div>
          </div>
        </div>

        <!-- Controls -->
        <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
    </div>
    <div class="col-md-4">
      <div class="list-group">
        <a href="#" class="list-group-item active">
          最热
        </a>
        <a href="#" class="list-group-item">Dapibus ac facilisis in</a>
        <a href="#" class="list-group-item">Morbi leo risus</a>
        <a href="#" class="list-group-item">Porta ac consectetur ac</a>
        <a href="#" class="list-group-item">Vestibulum at eros</a>
        <a href="#" class="list-group-item">Vestibulum at eros</a>
      </div>
    </div>
  </div>
  
  <hr>
  <div class="container" style="margin-bottom: 100px;">
    <div class="row">
      <%for(var i = 0;i < tiezi.length;i++){%>
        <div class="col-sm-6 col-md-3">
          <div class="thumbnail">
            <img src="../images/01.jpg" alt="...">
            <div class="caption">
              <h3><%=tiezi[i].title%></h3>
              <p><%=tiezi[i].abstract%></p>
            </div>
            <button type="button" class="btn btn-primary btn-xs">查看详细</button>
          </div>
        </div>
      <%}%>
    </div>
  </div>

  <footer class="navbar-fixed-bottom">
    <p>微力实验室</p>
    <p>作者：张中俊</p>
  </footer>

	<script src="/js/jquery-1.11.2.min.js"></script>
	<script src="/js/bootstrap.js"></script>
  <script type="text/javascript">
    document.onreadystatechange=function(){
      if (document.readyState=='complete') {
        $('.loading').fadeOut();
      }
    }
    $("#login").click(function(){
      $("#mark1").css('display','block');
      $("#form1").css('display','block');
    })
    $("#Fregist").click(function(){
      window.open("/regist","_self");
    })
    $("#confirmImg").click(function(){
      $("#confirmImg").attr("src","/captcha?flag="+Math.random());
    })

    // 用ajax发送数据
    $("#login1").click(function(){
      $.post("/dologin",{
        "username":$.trim($("#username").val()),
        "password":$("#psd").val(),
        "confirm":$.trim($("#confirm").val())
      },function(result){
        if (result == -1) {
          alert("用户名不存在！");
        }
        else if (result == -2) {
          alert("密码错误！");
        }
        else if (result == -3) {
          $(".tip-block").css("display","none");
          $(".err-block").css("display","block");
          $("#confirmImg").attr("src","/captcha?flag="+Math.random());
          $("#confirm").focus(function(){
            $(".tip-block").css("display","block");
            $(".err-block").css("display","none");
          });
        }
        else if (result == 2) {
          alert("登陆失败！");
        }
        else if(result == 7){
          alert("查找帖子失败！");
        }
        else if(result == 1){
          alert("登录成功！");
          // $("#mark1").css('display','none');
          // $("#form1").css('display','none');
          window.location = "/";
        }
      })
    })

    $("#pcenter").click(function(){
      $.get("/pcenter",{},function(result){})
    })

  </script>
</body>
</html>